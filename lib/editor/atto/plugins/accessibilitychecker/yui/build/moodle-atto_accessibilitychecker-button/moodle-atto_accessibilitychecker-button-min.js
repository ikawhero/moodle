YUI.add("moodle-atto_accessibilitychecker-button",function(e,t){var n="atto_accessibilitychecker";e.namespace("M.atto_accessibilitychecker").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{initializer:function(){this.addButton({icon:"e/accessibility_checker",callback:this._displayDialogue})},_displayDialogue:function(){var e=this.getDialogue({headerContent:M.util.get_string("pluginname",n),width:"500px",focusAfterHide:true});e.set("bodyContent",this._getDialogueContent()).show()},_getDialogueContent:function(){var t=e.Node.create('<div style="word-wrap: break-word;"></div>');t.append(this._getWarnings());t.delegate("click",function(e){e.preventDefault();var t=this.get("host"),n=e.currentTarget.getData("sourceNode"),r=this.getDialogue();if(n){r.set("focusAfterHide",this.editor).hide();t.setSelection(t.getSelectionFromNode(n))}else{r.hide()}},"a",this);return t},_getWarnings:function(){var t,r=e.Node.create("<div></div>");var i=this.get("level");t=[];this.editor.all("img").each(function(e){alt=e.getAttribute("alt");if(typeof alt==="undefined"||alt===""){if(e.getAttribute("role")!=="presentation"){t.push(e)}}},this);this._addWarnings(r,M.util.get_string("imagesmissingalt",n),t,true);t=[];this.editor.all("*").each(function(n){var r,s,o,u,a;if(e.Lang.trim(n.get("text"))!==""){r=n.getComputedStyle("color");s=n.getComputedStyle("backgroundColor");u=this._getLuminanceFromCssColor(r);a=this._getLuminanceFromCssColor(s);if(u>a){o=(u+.05)/(a+.05)}else{o=(a+.05)/(u+.05)}if(i==3&&o<=7||i==2&&o<=4.5){var f=0,l=false;for(f=0;f<t.length;f++){if(n.ancestors("*").indexOf(t[f])!==-1){l=true;break}else if(t[f].ancestors("*").indexOf(n)!==-1){t[f]=n;l=true;break}}if(!l){t.push(n)}}}},this);this._addWarnings(r,M.util.get_string("needsmorecontrast",n),t,false);if(this.editor.get("text").length>1e3&&!this.editor.one("h3, h4, h5")){this._addWarnings(r,M.util.get_string("needsmoreheadings",n),[this.editor],false)}t=[];this.editor.all("table").each(function(e){caption=e.one("caption");if(caption===null||caption.get("text").trim()===""){t.push(e)}},this);this._addWarnings(r,M.util.get_string("tablesmissingcaption",n),t,false);t=[];this.editor.all("table").each(function(e){caption=e.one("[colspan],[rowspan]");if(caption!==null){t.push(e)}},this);this._addWarnings(r,M.util.get_string("tableswithmergedcells",n),t,false);t=[];this.editor.all("table").each(function(e){if(e.one("tr").one("td")){e.all("tr").some(function(n){var r=n.one("th");if(!r||r.get("text").trim()===""){t.push(e);return true}return false},this)}else{var n=false;e.one("tr").all("th").some(function(r){n=true;if(r.get("text").trim()===""){t.push(e);return true}return false});if(!n){t.push(e)}}},this);this._addWarnings(r,M.util.get_string("tablesmissingheaders",n),t,false);if(!r.hasChildNodes()){r.append("<p>"+M.util.get_string("nowarnings",n)+"</p>")}return r},_addWarnings:function(t,r,i,s){var o,u,a,f,l,c,h,p;if(i.length>0){o=e.Node.create("<p>"+r+"</p>");u=e.Node.create('<ol class="accessibilitywarnings"></ol>');a=0;for(a=0;a<i.length;a++){c=e.Node.create("<li></li>");if(s){f=i[a].getAttribute("src");h=e.Node.create('<a href="#"><img src="'+f+'" /> '+f+"</a>")}else{l="innerText"in i[a]?"innerText":"textContent";p=i[a].get(l).trim();if(p===""){p=M.util.get_string("emptytext",n)}if(i[a]===this.editor){p=M.util.get_string("entiredocument",n)}h=e.Node.create('<a href="#">'+p+"</a>")}h.setData("sourceNode",i[a]);c.append(h);u.append(c)}o.append(u);t.append(o)}},_getLuminanceFromCssColor:function(t){var n;if(t==="transparent"){t="#ffffff"}n=e.Color.toArray(e.Color.toRGB(t));var r=function(e){e=parseInt(e,10)/255;if(e<=.03928){e=e/12.92}else{e=Math.pow((e+.055)/1.055,2.4)}return e};var i=r(n[0]),s=r(n[1]),o=r(n[2]);return.2126*i+.7152*s+.0722*o}},{ATTRS:{level:{value:2}}})},"@VERSION@",{requires:["color-base","moodle-editor_atto-plugin"]})
